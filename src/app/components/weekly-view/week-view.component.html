<div class="week-container">

  <!-- Weekly Header -->
  <div class="week-header">
    <div class="header-row">
      <!-- Top Left Corner -->
      <div class="corner-cell">
        <span class="header-label">Empleado</span>
        <span class="sub-label">Rol / Status</span>
      </div>

      <!-- Days Columns -->
      <div class="days-track">
        @for(day of weekDays(); track day) {
          <div class="day-column-header"
               [class.is-holiday]="isHoliday(day)">

            <div class="day-info">
              <span class="day-name">{{ getDayName(day) }}</span>
              <span class="day-number">{{ day.getDate() }}</span>
            </div>

            @if(isHoliday(day)) {
               <div class="holiday-badge">
                 <span class="material-symbols-outlined icon-xs" title="Feriado">star</span>
               </div>
            }

            <!-- Daily Metrics (Coverage Score Placeholder) -->
            <div class="metrics-bar">
               <div class="metric-track">
                  <div class="metric-fill"></div>
               </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Main Grid -->
  <div class="grid-scroll custom-scrollbar">
    @for(row of gridData(); track row.member.id) {
      <div class="grid-row group-row">

        <!-- Row Header (Sticky Left) -->
        <div class="row-header-cell cursor-pointer hover:bg-slate-100" (click)="openPersonDetails(row.member)">
          <div class="avatar-circle">
             {{ row.member.fullName.substring(0,2) }}
          </div>
          <div class="row-details">
             <p class="row-name">{{ row.member.fullName }}</p>
             <p class="row-role">{{ row.member.role }}</p>
          </div>
        </div>

        <!-- Days Cells -->
        <div class="days-row">
          @for(cell of row.days; track cell.dateStr) {
             <div class="grid-cell"
                  [class.has-shift]="cell.shifts.length > 0"
                  (click)="onCellClick(cell.date, row.member.id)"
                  (dragover)="onDragOver($event)"
                  (drop)="onDrop($event, cell.date, row.member.id)">

                @if(cell.shifts.length > 0) {
                   @for(shift of cell.shifts; track shift.id) {
                      <div class="mini-shift-card"
                           [class.draft]="shift.status === 'draft'"
                           draggable="true"
                           (dragstart)="onDragStart($event, shift)"
                           (click)="onShiftClick($event, shift)">
                         <div class="shift-content">
                            <span class="shift-time">{{ shift.start }} - {{ shift.end }}</span>
                            @if(shift.status === 'draft') {
                              <span class="dot-draft"></span>
                            }
                         </div>
                      </div>
                   }
                } @else {
                  <!-- Empty State / Add Button on Hover -->
                  <div class="add-btn-overlay">
                     <span class="material-symbols-outlined">add_circle</span>
                  </div>
                }

             </div>
          }
        </div>

      </div>
    }
  </div>

  <app-shift-edit-dialog
    [isOpen]="isDialogOpen()"
    [shift]="selectedShift()"
    [isNewEntry]="isNewEntry()"
    (closeEvent)="closeDialog()"
    (saveEvent)="saveShift($event)"
    (deleteEvent)="deleteShift($event)">
  </app-shift-edit-dialog>

  <app-person-details-dialog
    [isOpen]="isPersonDialogOpen()"
    [staff]="selectedPerson()"
    (closeEvent)="closePersonDialog()">
  </app-person-details-dialog>

</div>
